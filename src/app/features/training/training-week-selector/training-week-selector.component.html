<div class="container mt-4">
  <h2>Entrenamientos</h2>
  @if (storedWeeks.length === 0) {
  <div class="alert alert-warning" role="alert">
    No hay semanas de entrenamiento disponibles.
  </div>
  <app-training-csv-loader></app-training-csv-loader>
  } @else {
  <h5>Semanas disponibles</h5>
  <div class="btn-group mb-3" role="group" aria-label="Semanas">
    @for (week of storedWeeks; track week.name) {
    <button type="button" class="btn btn-outline-primary" [class.active]="selectedWeek === week"
      (click)="selectWeek(week)">
      {{ week.name }}
    </button>
    }
  </div>

  @if (selectedWeek) {
  <div>
    <h6>Sesiones de la semana {{ selectedWeek.name }}</h6>
    <div class="btn-group mb-3" role="group" aria-label="Sesiones">
      @for (session of selectedWeek.sessions; track session.sessionNumber) {
      <button type="button" class="btn btn-outline-secondary" [class.active]="selectedSession === session"
        (click)="selectSession(session)">
        Sesión {{ session.sessionNumber }}
      </button>
      }
    </div>
  </div>
  }

  @if (selectedSession) {
  <div>
    <h6>Ejercicios de la sesión {{ selectedSession.sessionNumber }}</h6>
    <ul class="list-group">
      @for (ex of selectedSession.exercises; track ex.name) {
      <li class="list-group-item">
        <strong>{{ ex.name }}</strong>
        @if (ex.sets && ex.sets.length > 0) {
        <ul class="list-inline mt-1">
          <div class="d-flex flex-wrap flex-sm-row gap-2">
            @for (set of ex.sets; track set.weightPercent) {
              <button type="button" class="btn btn-outline-primary btn-sm" (click)="openCalculatorForSet(ex, set)">
                {{ set.weightPercent ? set.weightPercent + '%' : '' }} {{ set.reps }}
              </button>
            }
          </div>
        </ul>

        } @else {
        <span class="badge bg-primary ms-2">
          {{ ex.repLibres }}
        </span>
        }
        @if (selectedCalculator?.exercise?.exerciseType === ex?.exerciseType && selectedCalculator?.exercise?.name === ex?.name) {
        <div class="mt-3">
          @let exCalc = selectedCalculator?.exercise!;
          @let setCalc = selectedCalculator?.set!;
          @let pr = getPersonalRecordForType(exCalc.exerciseType!);
          <app-bumper-plates-calculator (closedSignal)="closeCalculator()" [externalInputModeInput]="true"
            [initialWeightInput]="initialWeight" [initialWeightUnitInput]="initialWeightUnit"
            [desiredWeightInput]="pr && setCalc?.weightPercent ? (pr?.record! * setCalc?.weightPercent! / 100) : pr?.record ?? 20"
            [desiredWeightUnitInput]="pr?.recordUnit ?? 'kg'">
          </app-bumper-plates-calculator>
        </div>
        }
      </li>
      }
    </ul>
  </div>
  }
  }
</div>
